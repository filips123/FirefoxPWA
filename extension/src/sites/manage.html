<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Manage web apps and profiles</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <link rel="shortcut icon" type="image/png" href="../images/addon-logo.svg" />
    <link rel="stylesheet" href="manage.scss" />
  </head>

  <body>
    <div class="card vh-100">
      <div class="card-header sticky-top">
        <nav>
          <div class="nav nav-tabs card-header-tabs" id="card-navigation" role="tablist">
            <button class="nav-link active" id="sites-tab" data-bs-toggle="tab" data-bs-target="#sites-pane" type="button" role="tab" aria-controls="sites-pane" aria-selected="true">Apps</button>
            <button class="nav-link" id="profiles-tab" data-bs-toggle="tab" data-bs-target="#profiles-pane" type="button" role="tab" aria-controls="profiles-pane" aria-selected="false">Profiles</button>
            <button class="nav-link icon-link ms-auto py-0 bi-gear-fill lead" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-pane" type="button" role="tab" aria-controls="settings-pane" aria-selected="false"></button>
          </div>
        </nav>
      </div>

      <div class="card-body">
        <div class="tab-content">
          <div class="tab-pane fade show active" id="sites-pane" role="tabpanel" aria-labelledby="sites-tab">
            <ul class="list-group list-group-flush" id="sites-list">
              <template id="sites-list-template">
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="site-icon me-2 my-auto letter-icon" id="sites-list-template-letter"></div>
                  <img class="site-icon me-2 my-auto" id="sites-list-template-icon" alt="Icon" />
                  <div class="me-2 text-overflow-hide">
                    <div class="list-group-item-name" id="sites-list-template-title"></div>
                    <div class="list-group-item-description" id="sites-list-template-description"></div>
                  </div>
                  <div class="btn-group my-auto">
                    <button type="button" class="btn btn-outline-primary bi-box-arrow-up-right" id="sites-list-template-launch" title="Launch web app" aria-label="Launch web app"></button>
                    <button type="button" class="btn btn-outline-primary bi-pencil-square" id="sites-list-template-edit" title="Edit web app" aria-label="Edit web app"></button>
                    <button type="button" class="btn btn-outline-primary bi-trash" id="sites-list-template-remove" title="Remove web app" aria-label="Remove web app"></button>
                  </div>
                </li>
              </template>
              <li class="list-group-item justify-content-between align-items-start d-flex" id="sites-list-loading">
                <div>
                  <div><em>Loading...</em></div>
                </div>
              </li>
              <li class="list-group-item justify-content-between align-items-start d-flex d-none" id="sites-list-empty">
                <div>
                  <div><em>No sites installed!</em></div>
                </div>
              </li>
              <li id="site-install-item">
                <button type="button" class="list-group-item list-group-item-action" id="site-install-button">
                  <em>Install current site</em>
                </button>
              </li>
            </ul>
          </div>

          <div class="tab-pane fade" id="profiles-pane" role="tabpanel" aria-labelledby="profiles-tab">
            <ul class="list-group list-group-flush" id="profiles-list">
              <template id="profiles-list-template">
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="me-2 text-overflow-hide">
                    <div class="list-group-item-name" id="profiles-list-template-name"></div>
                    <div class="list-group-item-description" id="profiles-list-template-description"></div>
                  </div>
                  <div class="btn-group my-auto">
                    <button type="button" class="btn btn-outline-primary bi-pencil-square" id="profiles-list-template-edit" title="Edit profile" aria-label="Edit profile"></button>
                    <button type="button" class="btn btn-outline-primary bi-trash" id="profiles-list-template-remove" title="Remove profile" aria-label="Remove remove"></button>
                  </div>
                </li>
              </template>
              <li class="list-group-item justify-content-between align-items-start d-flex" id="profiles-list-loading">
                <div>
                  <div><em>Loading...</em></div>
                </div>
              </li>
              <li class="list-group-item justify-content-between align-items-start d-flex d-none" id="profiles-list-empty">
                <div>
                  <div><em>No profiles available!</em></div>
                </div>
              </li>
              <li id="profile-create-item">
                <button type="button" class="list-group-item list-group-item-action" id="profile-create-button">
                  <em>Create a new profile</em>
                </button>
              </li>
            </ul>
          </div>

          <div class="tab-pane fade" id="settings-pane" role="tabpanel" aria-labelledby="settings-tab">
            <div class="list-group list-group-flush">
              <div class="list-group-item">
                <div class="row align-items-center">
                  <div>
                    <label class="fw-bold mb-0" for="settings-display-page-action">Display address bar widget</label>
                  </div>
                  <div id="settings-display-page-action">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="settings-display-page-action" id="settings-display-page-action-valid" value="valid" checked>
                      <label class="form-check-label" for="settings-display-page-action-valid">On valid progressive web apps</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="settings-display-page-action" id="settings-display-page-action-always" value="always">
                      <label class="form-check-label" for="settings-display-page-action-always">Always</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="settings-display-page-action" id="settings-display-page-action-never" value="never">
                      <label class="form-check-label" for="settings-display-page-action-never">Never</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item">
                <div class="row align-items-center">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-launch-current-url">Launch PWAs with current URLs</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-launch-current-url">
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item" id="settings-always-patch-container" title="Loading...">
                <div class="row align-items-center">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-always-patch">Always patch runtime and profile</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-always-patch" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item d-none" id="settings-enable-wayland-container" title="Loading...">
                <div class="row align-items-center">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-enable-wayland">Use Wayland Display Server</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-enable-wayland" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item d-none" id="settings-use-xinput2-container" title="Loading...">
                <div class="row align-items-center">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-use-xinput2">Use X Input Extension 2</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-use-xinput2" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item d-none" id="settings-use-portals-container" title="Loading...">
                <div class="row align-items-center">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-use-portals">Use XDG Desktop Portals</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-use-portals" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <div class="list-group-item">
                <div class="row align-items-center" title="Can only be enabled in the system settings">
                  <div class="col">
                    <label class="fw-bold mb-0" for="settings-enable-dark-mode">Enable dark mode</label>
                  </div>
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="settings-enable-dark-mode" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <button type="button" class="list-group-item list-group-item-action fw-bold" id="update-all-sites">
                Update web apps
              </button>

              <button type="button" class="list-group-item list-group-item-action fw-bold" id="reinstall-runtime">
                Reinstall runtime
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="card-footer ps-2 pe-0 m-0 row bg-warning text-dark d-none" id="extension-outdated-box">
        <p class="col-11 mx-0 my-auto">This extension is outdated! <a id="extension-outdated-update" target="_blank">Please update it</a>!</p>
        <button type="button" class="col-1 btn-close my-auto tiny" id="extension-outdated-close" aria-label="Close"></button>
      </div>
      <div class="card-footer px-2 mx-0 row" id="search-box">
        <input class="form-control" id="search-input" type="search" placeholder="Search by name" aria-label="Search by name" />
      </div>
    </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="site-edit-offcanvas" aria-labelledby="site-edit-label">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="site-edit-label">Edit web app</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <form class="needs-validation" id="web-app-form">
          <div class="mb-3">
            <label for="web-app-name" class="form-label">Name</label>
            <input type="text" class="form-control form-control-sm" id="web-app-name" />
            <div class="invalid-feedback" id="web-app-name-invalid"></div>
          </div>
          <div class="mb-3">
            <label for="web-app-description" class="form-label">Description</label>
            <input type="text" class="form-control form-control-sm" id="web-app-description" />
          </div>
          <div class="mb-3">
            <label for="web-app-categories" class="form-label">Categories</label>
            <select class="form-select-tags" id="web-app-categories" multiple data-allow-new="true">
              <option selected disabled hidden value="">​</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="web-app-keywords" class="form-label">Keywords</label>
            <select class="form-select-tags" id="web-app-keywords" multiple data-allow-new="true">
              <option selected disabled hidden value="">​</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="web-app-start-url" class="form-label">Start URL</label>
            <input type="url" class="form-control form-control-sm" id="web-app-start-url" />
            <div class="invalid-feedback" id="web-app-start-url-invalid"></div>
          </div>
          <button type="submit" class="btn btn-primary" id="web-app-submit" disabled>Loading...</button>
        </form>
      </div>
    </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="profile-edit-offcanvas" aria-labelledby="profile-edit-label">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="profile-edit-label">Edit profile</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <form class="needs-validation" id="profile-form">
          <div class="mb-3">
            <label for="profile-name" class="form-label">Name</label>
            <input type="text" class="form-control form-control-sm" id="profile-name" />
          </div>
          <div class="mb-3">
            <label for="profile-description" class="form-label">Description</label>
            <input type="text" class="form-control form-control-sm" id="profile-description" />
          </div>
          <button type="submit" class="btn btn-primary" id="profile-submit" disabled>Loading...</button>
        </form>
      </div>
    </div>

    <div class="modal fade" id="site-remove-modal" tabindex="-1" aria-labelledby="site-remove-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="site-remove-label">Remove web app</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to remove this web app? App data will <strong>not</strong> be
            removed, but you can remove them through browser or by deleting app's profile.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="site-remove-button">Remove</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="profile-remove-modal" tabindex="-1" aria-labelledby="profile-remove-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="profile-remove-label">Remove profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>
              Are you sure you want to remove this profile? This will completely remove the profile and all
              associated sites, including their data. You might not be able to fully recover this action.
            </p>
            <p class="d-none" id="profile-remove-default">
              Default profile cannot be completely removed. Sites and data will be cleared, but the profile will stay.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="profile-remove-button">Remove</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="update-all-sites-modal" tabindex="-1" aria-labelledby="update-all-sites-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="update-all-sites-label">Update web apps</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>This will download and parse manifests for all your web apps and register them again to the operating systems. Any changes in web app manifests will also be reflected on your system.</p>
            <p>Alternatively, you can register all web apps to the operating system without performing any manifest updates. This can be used if you transferred your config file from another device.</p>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" value="" id="update-all-sites-manifests" checked>
              <label class="form-check-label" for="update-all-sites-manifests">Perform manifest updates</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="update-all-sites-button">Update</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="reinstall-runtime-modal" tabindex="-1" aria-labelledby="reinstall-runtime-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reinstall-runtime-label">Reinstall Firefox runtime</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to reinstall the PWAsForFirefox runtime? This will remove your current runtime and download the latest version from Mozilla.</p>
            <p>This will <strong>not</strong> affect your main Firefox browser and will <strong>not</strong> remove any PWA profiles or other data.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="reinstall-runtime-button">Reinstall</button>
          </div>
        </div>
      </div>
    </div>

    <div class="toast fade hide" id="error-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="15000">
      <div class="toast-header">
        <strong class="me-auto">Error</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body" id="error-text"></div>
    </div>

    <script type="module" src="manage.js"></script>
  </body>
</html>
